<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
 <title>Analytics Dashboard</title>
 <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
 <style>
 body { 
   margin: 0; 
   padding: 20px; 
   font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
   background: #f5f5f5;
 }
 .container {
   max-width: 1400px;
   margin: 0 auto;
   background: white;
   padding: 30px;
   border-radius: 8px;
   box-shadow: 0 2px 8px rgba(0,0,0,0.1);
 }
 h1 {
   color: #333;
   margin-bottom: 10px;
   font-size: 28px;
 }
 .dashboard-subtitle {
   color: #666;
   margin-bottom: 30px;
   font-size: 14px;
 }
 .analysis-section {
   margin-bottom: 60px;
   padding-bottom: 40px;
   border-bottom: 2px solid #e0e0e0;
 }
 .analysis-section:last-child {
   border-bottom: none;
 }
 .section-title {
   font-size: 24px;
   font-weight: 600;
   color: #333;
   margin-bottom: 10px;
 }
 .section-timestamp {
   color: #666;
   font-size: 12px;
   margin-bottom: 20px;
 }
 .section-description {
   color: #555;
   font-size: 14px;
   margin-bottom: 25px;
   line-height: 1.6;
 }
 .chart-container {
   margin-bottom: 40px;
 }
 .chart-title {
   font-size: 18px;
   font-weight: 600;
   color: #333;
   margin-bottom: 15px;
   padding-bottom: 10px;
   border-bottom: 2px solid #e0e0e0;
 }
 .chart {
   width: 100%; 
   height: 500px;
 }
 .stats-grid {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
   gap: 20px;
   margin-bottom: 30px;
 }
 .stat-card {
   background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
   color: white;
   padding: 20px;
   border-radius: 8px;
   text-align: center;
 }
 .stat-card.revenue {
   background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
 }
 .stat-card.expenditure {
   background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
 }
 .stat-card.profit {
   background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
 }
 .stat-value {
   font-size: 32px;
   font-weight: bold;
   margin: 10px 0;
 }
 .stat-label {
   font-size: 14px;
   opacity: 0.9;
 }
 </style>
</head>
<body>
 <div class="container">
   <h1>Analytics Dashboard</h1>
   <div class="dashboard-subtitle">Interactive analytics workspace - All analyses displayed here</div>
   
   <div id="analytics-content">
     <!-- Analysis Section: Pune Financial Health -->
     <div class="analysis-section" id="analysis-pune-financial-health-2025-02-13">
       <div class="section-title">Pune Municipal Corporation Financial Health Analysis</div>
       <div class="section-timestamp">Created: 2025-02-13</div>
       <div class="section-description">
         Financial analysis of Pune Municipal Corporation covering fiscal years 2014-15 to 2020-21. 
         Analysis includes revenue trends, expenditure patterns, and calculated profit/loss metrics.
       </div>
       
       <div class="stats-grid">
         <div class="stat-card revenue">
           <div class="stat-label">Average Revenue</div>
           <div class="stat-value">₹4,13,560</div>
         </div>
         <div class="stat-card expenditure">
           <div class="stat-label">Average Expenditure</div>
           <div class="stat-value">₹4,06,943</div>
         </div>
         <div class="stat-card profit">
           <div class="stat-label">Net Average</div>
           <div class="stat-value">₹6,617</div>
         </div>
       </div>

       <div class="chart-container">
         <div class="chart-title">Revenue & Expenditure Trends Over Time</div>
         <div id="trendChart" class="chart"></div>
       </div>

       <div class="chart-container">
         <div class="chart-title">Year-wise Revenue vs Expenditure Comparison</div>
         <div id="comparisonChart" class="chart"></div>
       </div>

       <div class="chart-container">
         <div class="chart-title">Calculated Profit/Loss (Revenue - Expenditure)</div>
         <div id="profitLossChart" class="chart"></div>
       </div>
     </div>
     
     <!-- Analysis Section: Revenue-Expenditure Correlation -->
     <div class="analysis-section" id="analysis-correlation-2025-02-13">
       <div class="section-title">Revenue-Expenditure Correlation Analysis</div>
       <div class="section-timestamp">Created: 2025-02-13</div>
       <div class="section-description">
         Statistical analysis examining the relationship between revenue and expenditure. 
         This analysis calculates the Pearson correlation coefficient to quantify how strongly 
         these two financial metrics move together over time.
       </div>
       
       <div class="stats-grid">
         <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
           <div class="stat-label">Correlation Coefficient</div>
           <div class="stat-value" id="corr-value">-</div>
         </div>
         <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
           <div class="stat-label">R-squared</div>
           <div class="stat-value" id="rsquared-value">-</div>
         </div>
         <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
           <div class="stat-label">Interpretation</div>
           <div class="stat-value" style="font-size: 18px;" id="interpretation-value">-</div>
         </div>
       </div>

       <div class="chart-container">
         <div class="chart-title">Revenue vs Expenditure Scatter Plot</div>
         <div id="correlationScatterChart" class="chart"></div>
       </div>

       <div class="chart-container">
         <div class="chart-title">Correlation Analysis Insights</div>
         <div id="correlationInsights" style="padding: 20px; background: #f9f9f9; border-radius: 8px; line-height: 1.8;">
           <p id="insights-text" style="margin: 0; color: #555;"></p>
         </div>
       </div>
    </div>
    
    <!-- Analysis Section: Data Summary -->
    <div class="analysis-section" id="analysis-data-summary-2025-02-13">
      <div class="section-title">Pune Financial Health 2022 - Data Summary</div>
      <div class="section-timestamp">Created: 2025-02-13</div>
      <div class="section-description">
        Comprehensive summary of the Pune Municipal Corporation financial health dataset covering fiscal years 2014-15 to 2020-21.
      </div>
      
      <div class="stats-grid">
        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
          <div class="stat-label">Total Records</div>
          <div class="stat-value">7</div>
        </div>
        <div class="stat-card revenue">
          <div class="stat-label">Avg Revenue</div>
          <div class="stat-value">₹4,13,560</div>
        </div>
        <div class="stat-card expenditure">
          <div class="stat-label">Avg Expenditure</div>
          <div class="stat-value">₹4,06,943</div>
        </div>
        <div class="stat-card profit">
          <div class="stat-label">Avg Net</div>
          <div class="stat-value">₹6,617</div>
        </div>
      </div>

      <div class="chart-container">
        <div class="chart-title">Dataset Overview</div>
        <div id="summaryTable" style="padding: 20px; background: #f9f9f9; border-radius: 8px;">
          <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
            <thead>
              <tr style="background: #667eea; color: white;">
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #555;">Metric</th>
                <th style="padding: 12px; text-align: right; border-bottom: 2px solid #555;">Revenue (₹ Lakhs)</th>
                <th style="padding: 12px; text-align: right; border-bottom: 2px solid #555;">Expenditure (₹ Lakhs)</th>
                <th style="padding: 12px; text-align: right; border-bottom: 2px solid #555;">Net (₹ Lakhs)</th>
              </tr>
            </thead>
            <tbody id="summaryTableBody">
              <!-- Data will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>

      <div class="chart-container">
        <div class="chart-title">Key Insights</div>
        <div id="summaryInsights" style="padding: 20px; background: #f9f9f9; border-radius: 8px; line-height: 1.8;">
          <p id="insights-summary-text" style="margin: 0; color: #555;"></p>
        </div>
      </div>

      <div class="chart-container">
        <div class="chart-title">Year-by-Year Financial Performance</div>
        <div id="yearlyPerformanceChart" class="chart"></div>
      </div>
    </div>
    
    <!-- New analysis sections will be appended here -->
  </div>
</div>
 
 <script>
 // Pune Financial Health Analysis - Chart Initialization
 (function() {
   // Data
   const years = ['2014-15', '2015-16', '2016-17', '2017-18', '2018-19', '2019-20', '2020-21'];
   const revenue = [332576, 403733, 372848, 430659, 439106, 444668, 471331];
   const expenditure = [319542, 348443, 408931, 390248, 455144, 446151, 480144];
   
   // Calculate profit/loss
   const profitLoss = revenue.map((rev, idx) => rev - expenditure[idx]);

   // Initialize Trend Chart
   const trendChart = echarts.init(document.getElementById('trendChart'));
   const trendOption = {
     tooltip: {
       trigger: 'axis',
       formatter: function(params) {
         let result = params[0].name + '<br/>';
         params.forEach(param => {
           result += param.marker + param.seriesName + ': ₹' + param.value.toLocaleString('en-IN') + ' Lakhs<br/>';
         });
         return result;
       }
     },
     legend: {
       data: ['Revenue', 'Expenditure'],
       top: 10
     },
     grid: {
       left: '3%',
       right: '4%',
       bottom: '3%',
       containLabel: true
     },
     xAxis: {
       type: 'category',
       boundaryGap: false,
       data: years,
       axisLabel: {
         rotate: 0
       }
     },
     yAxis: {
       type: 'value',
       name: 'Amount (₹ Lakhs)',
       axisLabel: {
         formatter: function(value) {
           return '₹' + (value / 1000).toFixed(0) + 'K';
         }
       }
     },
     series: [
       {
         name: 'Revenue',
         type: 'line',
         smooth: true,
         data: revenue,
         itemStyle: { color: '#11998e' },
         areaStyle: {
           color: {
             type: 'linear',
             x: 0,
             y: 0,
             x2: 0,
             y2: 1,
             colorStops: [{
               offset: 0, color: 'rgba(17, 153, 142, 0.3)'
             }, {
               offset: 1, color: 'rgba(17, 153, 142, 0.05)'
             }]
           }
         },
         markPoint: {
           data: [
             { type: 'max', name: 'Max Revenue' },
             { type: 'min', name: 'Min Revenue' }
           ]
         }
       },
       {
         name: 'Expenditure',
         type: 'line',
         smooth: true,
         data: expenditure,
         itemStyle: { color: '#ee0979' },
         areaStyle: {
           color: {
             type: 'linear',
             x: 0,
             y: 0,
             x2: 0,
             y2: 1,
             colorStops: [{
               offset: 0, color: 'rgba(238, 9, 121, 0.3)'
             }, {
               offset: 1, color: 'rgba(238, 9, 121, 0.05)'
             }]
           }
         },
         markPoint: {
           data: [
             { type: 'max', name: 'Max Expenditure' },
             { type: 'min', name: 'Min Expenditure' }
           ]
         }
       }
     ]
   };
   trendChart.setOption(trendOption);

   // Initialize Comparison Chart
   const comparisonChart = echarts.init(document.getElementById('comparisonChart'));
   const comparisonOption = {
     tooltip: {
       trigger: 'axis',
       axisPointer: {
         type: 'shadow'
       },
       formatter: function(params) {
         let result = params[0].name + '<br/>';
         params.forEach(param => {
           result += param.marker + param.seriesName + ': ₹' + param.value.toLocaleString('en-IN') + ' Lakhs<br/>';
         });
         return result;
       }
     },
     legend: {
       data: ['Revenue', 'Expenditure'],
       top: 10
     },
     grid: {
       left: '3%',
       right: '4%',
       bottom: '3%',
       containLabel: true
     },
     xAxis: {
       type: 'category',
       data: years,
       axisLabel: {
         rotate: 0
       }
     },
     yAxis: {
       type: 'value',
       name: 'Amount (₹ Lakhs)',
       axisLabel: {
         formatter: function(value) {
           return '₹' + (value / 1000).toFixed(0) + 'K';
         }
       }
     },
     series: [
       {
         name: 'Revenue',
         type: 'bar',
         data: revenue,
         itemStyle: { color: '#11998e' },
         label: {
           show: true,
           position: 'top',
           formatter: function(params) {
             return '₹' + (params.value / 1000).toFixed(0) + 'K';
           }
         }
       },
       {
         name: 'Expenditure',
         type: 'bar',
         data: expenditure,
         itemStyle: { color: '#ee0979' },
         label: {
           show: true,
           position: 'top',
           formatter: function(params) {
             return '₹' + (params.value / 1000).toFixed(0) + 'K';
           }
         }
       }
     ]
   };
   comparisonChart.setOption(comparisonOption);

   // Initialize Profit/Loss Chart
   const profitLossChart = echarts.init(document.getElementById('profitLossChart'));
   const profitLossOption = {
     tooltip: {
       trigger: 'axis',
       formatter: function(params) {
         const value = params[0].value;
         const sign = value >= 0 ? '+' : '';
         return params[0].name + '<br/>' + 
                params[0].marker + 'Net: ' + sign + '₹' + value.toLocaleString('en-IN') + ' Lakhs';
       }
     },
     grid: {
       left: '3%',
       right: '4%',
       bottom: '3%',
       containLabel: true
     },
     xAxis: {
       type: 'category',
       data: years,
       axisLabel: {
         rotate: 0
       }
     },
     yAxis: {
       type: 'value',
       name: 'Profit/Loss (₹ Lakhs)',
       axisLabel: {
         formatter: function(value) {
           const sign = value >= 0 ? '+' : '';
           return sign + '₹' + (value / 1000).toFixed(0) + 'K';
         }
       }
     },
     series: [
       {
         name: 'Profit/Loss',
         type: 'bar',
         data: profitLoss,
         itemStyle: {
           color: function(params) {
             return params.value >= 0 ? '#38ef7d' : '#f5576c';
           }
         },
         label: {
           show: true,
           position: 'top',
           formatter: function(params) {
             const value = params.value;
             const sign = value >= 0 ? '+' : '';
             return sign + '₹' + (value / 1000).toFixed(1) + 'K';
           }
         }
       }
     ],
     markLine: {
       data: [
         { type: 'average', name: 'Average' },
         { yAxis: 0, name: 'Break-even' }
       ]
     }
   };
   profitLossChart.setOption(profitLossOption);

   // Handle window resize
   window.addEventListener('resize', function() {
     trendChart.resize();
     comparisonChart.resize();
     profitLossChart.resize();
   });
 })();

 // Global resize handler for all charts (for future additions)
 window.addEventListener('resize', function() {
   // This will be extended as new charts are added
   const charts = echarts.getInstanceByDom(document.getElementById('trendChart'));
   if (charts && charts.length) charts.forEach(chart => chart.resize());
 });

 // Correlation Analysis - Chart Initialization
 (function() {
   // Data
   const revenue = [332576, 403733, 372848, 430659, 439106, 444668, 471331];
   const expenditure = [319542, 348443, 408931, 390248, 455144, 446151, 480144];
   
   // Calculate Pearson correlation coefficient
   function calculateCorrelation(x, y) {
     const n = x.length;
     const xMean = x.reduce((a, b) => a + b, 0) / n;
     const yMean = y.reduce((a, b) => a + b, 0) / n;
     
     let numerator = 0;
     let xSumSq = 0;
     let ySumSq = 0;
     
     for (let i = 0; i < n; i++) {
       const xDiff = x[i] - xMean;
       const yDiff = y[i] - yMean;
       numerator += xDiff * yDiff;
       xSumSq += xDiff * xDiff;
       ySumSq += yDiff * yDiff;
     }
     
     const denominator = Math.sqrt(xSumSq * ySumSq);
     return denominator === 0 ? 0 : numerator / denominator;
   }
   
   const correlation = calculateCorrelation(revenue, expenditure);
   const rSquared = correlation * correlation;
   
   // Update stat cards
   document.getElementById('corr-value').textContent = correlation.toFixed(4);
   document.getElementById('rsquared-value').textContent = rSquared.toFixed(4);
   
   // Interpretation
   let interpretation = '';
   const absCorr = Math.abs(correlation);
   if (absCorr >= 0.9) {
     interpretation = 'Very Strong';
   } else if (absCorr >= 0.7) {
     interpretation = 'Strong';
   } else if (absCorr >= 0.5) {
     interpretation = 'Moderate';
   } else if (absCorr >= 0.3) {
     interpretation = 'Weak';
   } else {
     interpretation = 'Very Weak';
   }
   
   const direction = correlation > 0 ? 'Positive' : 'Negative';
   document.getElementById('interpretation-value').textContent = direction + ' (' + interpretation + ')';
   
   // Prepare scatter plot data
   const scatterData = revenue.map((rev, idx) => [rev, expenditure[idx]]);
   
   // Calculate regression line
   const xMean = revenue.reduce((a, b) => a + b, 0) / revenue.length;
   const yMean = expenditure.reduce((a, b) => a + b, 0) / expenditure.length;
   
   let slopeNum = 0;
   let slopeDen = 0;
   for (let i = 0; i < revenue.length; i++) {
     slopeNum += (revenue[i] - xMean) * (expenditure[i] - yMean);
     slopeDen += Math.pow(revenue[i] - xMean, 2);
   }
   const slope = slopeDen === 0 ? 0 : slopeNum / slopeDen;
   const intercept = yMean - slope * xMean;
   
   const minRev = Math.min(...revenue);
   const maxRev = Math.max(...revenue);
   const regressionLine = [
     [minRev, slope * minRev + intercept],
     [maxRev, slope * maxRev + intercept]
   ];
   
   // Initialize Scatter Chart
   const scatterChart = echarts.init(document.getElementById('correlationScatterChart'));
   const scatterOption = {
     tooltip: {
       trigger: 'item',
       formatter: function(params) {
         if (params.seriesName === 'Data Points') {
           return 'Year: ' + ['2014-15', '2015-16', '2016-17', '2017-18', '2018-19', '2019-20', '2020-21'][params.dataIndex] + '<br/>' +
                  'Revenue: ₹' + params.value[0].toLocaleString('en-IN') + ' Lakhs<br/>' +
                  'Expenditure: ₹' + params.value[1].toLocaleString('en-IN') + ' Lakhs';
         }
         return '';
       }
     },
     legend: {
       data: ['Data Points', 'Regression Line'],
       top: 10
     },
     grid: {
       left: '10%',
       right: '10%',
       bottom: '10%',
       containLabel: true
     },
     xAxis: {
       type: 'value',
       name: 'Revenue (₹ Lakhs)',
       nameLocation: 'middle',
       nameGap: 30,
       axisLabel: {
         formatter: function(value) {
           return '₹' + (value / 1000).toFixed(0) + 'K';
         }
       },
       splitLine: {
         show: true,
         lineStyle: {
           type: 'dashed'
         }
       }
     },
     yAxis: {
       type: 'value',
       name: 'Expenditure (₹ Lakhs)',
       nameLocation: 'middle',
       nameGap: 50,
       axisLabel: {
         formatter: function(value) {
           return '₹' + (value / 1000).toFixed(0) + 'K';
         }
       },
       splitLine: {
         show: true,
         lineStyle: {
           type: 'dashed'
         }
       }
     },
     series: [
       {
         name: 'Data Points',
         type: 'scatter',
         data: scatterData,
         symbolSize: 12,
         itemStyle: {
           color: '#667eea'
         },
         label: {
           show: true,
           position: 'right',
           formatter: function(params) {
             const years = ['2014-15', '2015-16', '2016-17', '2017-18', '2018-19', '2019-20', '2020-21'];
             return years[params.dataIndex];
           },
           fontSize: 10
         }
       },
       {
         name: 'Regression Line',
         type: 'line',
         data: regressionLine,
         lineStyle: {
           color: '#f5576c',
           width: 2,
           type: 'dashed'
         },
         symbol: 'none',
         tooltip: {
           show: false
         }
       }
     ]
   };
   scatterChart.setOption(scatterOption);
   
   // Generate insights
   const insights = `
     <strong>Key Findings:</strong><br/>
     • Correlation Coefficient (r): <strong>${correlation.toFixed(4)}</strong> - This indicates a ${direction.toLowerCase()} ${interpretation.toLowerCase()} relationship.<br/>
     • R-squared: <strong>${(rSquared * 100).toFixed(2)}%</strong> - This means ${(rSquared * 100).toFixed(1)}% of the variance in expenditure can be explained by revenue.<br/>
     • ${correlation > 0 ? 'As revenue increases, expenditure tends to increase as well.' : 'As revenue increases, expenditure tends to decrease.'}<br/>
     • The scatter plot shows ${correlation > 0.7 ? 'a strong linear relationship' : correlation > 0.5 ? 'a moderate linear relationship' : 'a weak linear relationship'} between the two variables.<br/>
     • ${Math.abs(correlation) > 0.7 ? 'The high correlation suggests that revenue and expenditure are closely linked, possibly indicating that expenditure scales with revenue.' : 'The moderate correlation suggests some relationship exists, but other factors also influence expenditure.'}
   `;
   document.getElementById('insights-text').innerHTML = insights;
   
  // Handle window resize
  window.addEventListener('resize', function() {
    scatterChart.resize();
  });
})();

// Data Summary Section - Chart Initialization
(function() {
  // Data
  const years = ['2014-15', '2015-16', '2016-17', '2017-18', '2018-19', '2019-20', '2020-21'];
  const revenue = [332576, 403733, 372848, 430659, 439106, 444668, 471331];
  const expenditure = [319542, 348443, 408931, 390248, 455144, 446151, 480144];
  const profitLoss = revenue.map((rev, idx) => rev - expenditure[idx]);
  
  // Calculate statistics
  const revenueMin = Math.min(...revenue);
  const revenueMax = Math.max(...revenue);
  const revenueAvg = Math.round(revenue.reduce((a, b) => a + b, 0) / revenue.length);
  
  const expenditureMin = Math.min(...expenditure);
  const expenditureMax = Math.max(...expenditure);
  const expenditureAvg = Math.round(expenditure.reduce((a, b) => a + b, 0) / expenditure.length);
  
  const profitLossMin = Math.min(...profitLoss);
  const profitLossMax = Math.max(...profitLoss);
  const profitLossAvg = Math.round(profitLoss.reduce((a, b) => a + b, 0) / profitLoss.length);
  
  // Populate summary table
  const tableBody = document.getElementById('summaryTableBody');
  const stats = [
    { label: 'Minimum', rev: revenueMin, exp: expenditureMin, net: profitLossMin },
    { label: 'Maximum', rev: revenueMax, exp: expenditureMax, net: profitLossMax },
    { label: 'Average', rev: revenueAvg, exp: expenditureAvg, net: profitLossAvg }
  ];
  
  stats.forEach(stat => {
    const row = document.createElement('tr');
    row.style.borderBottom = '1px solid #ddd';
    row.innerHTML = `
      <td style="padding: 10px; font-weight: 600; color: #333;">${stat.label}</td>
      <td style="padding: 10px; text-align: right; color: #11998e;">₹${stat.rev.toLocaleString('en-IN')}</td>
      <td style="padding: 10px; text-align: right; color: #ee0979;">₹${stat.exp.toLocaleString('en-IN')}</td>
      <td style="padding: 10px; text-align: right; color: ${stat.net >= 0 ? '#38ef7d' : '#f5576c'}; font-weight: 600;">${stat.net >= 0 ? '+' : ''}₹${stat.net.toLocaleString('en-IN')}</td>
    `;
    tableBody.appendChild(row);
  });
  
  // Add year-by-year data rows
  years.forEach((year, idx) => {
    const row = document.createElement('tr');
    row.style.borderBottom = '1px solid #eee';
    row.style.backgroundColor = idx % 2 === 0 ? '#fff' : '#fafafa';
    row.innerHTML = `
      <td style="padding: 8px; color: #666;">${year}</td>
      <td style="padding: 8px; text-align: right; color: #11998e;">₹${revenue[idx].toLocaleString('en-IN')}</td>
      <td style="padding: 8px; text-align: right; color: #ee0979;">₹${expenditure[idx].toLocaleString('en-IN')}</td>
      <td style="padding: 8px; text-align: right; color: ${profitLoss[idx] >= 0 ? '#38ef7d' : '#f5576c'}; font-weight: 600;">${profitLoss[idx] >= 0 ? '+' : ''}₹${profitLoss[idx].toLocaleString('en-IN')}</td>
    `;
    tableBody.appendChild(row);
  });
  
  // Generate insights
  const profitYears = profitLoss.filter(p => p > 0).length;
  const lossYears = profitLoss.filter(p => p < 0).length;
  const revenueGrowth = ((revenue[revenue.length - 1] - revenue[0]) / revenue[0] * 100).toFixed(1);
  const expenditureGrowth = ((expenditure[expenditure.length - 1] - expenditure[0]) / expenditure[0] * 100).toFixed(1);
  
  const insights = `
    <strong>Dataset Characteristics:</strong><br/>
    • <strong>Time Period:</strong> Fiscal years 2014-15 to 2020-21 (7 years)<br/>
    • <strong>City:</strong> Pune Municipal Corporation<br/>
    • <strong>Data Completeness:</strong> All years have revenue and expenditure data; profit/loss calculated from difference<br/><br/>
    
    <strong>Financial Performance:</strong><br/>
    • <strong>Profitable Years:</strong> ${profitYears} out of 7 (${(profitYears/7*100).toFixed(1)}%)<br/>
    • <strong>Loss Years:</strong> ${lossYears} out of 7 (${(lossYears/7*100).toFixed(1)}%)<br/>
    • <strong>Revenue Growth:</strong> ${revenueGrowth}% increase from 2014-15 to 2020-21<br/>
    • <strong>Expenditure Growth:</strong> ${expenditureGrowth}% increase from 2014-15 to 2020-21<br/><br/>
    
    <strong>Key Observations:</strong><br/>
    • Revenue ranges from ₹${revenueMin.toLocaleString('en-IN')} to ₹${revenueMax.toLocaleString('en-IN')} lakhs<br/>
    • Expenditure ranges from ₹${expenditureMin.toLocaleString('en-IN')} to ₹${expenditureMax.toLocaleString('en-IN')} lakhs<br/>
    • Average annual surplus: ₹${profitLossAvg.toLocaleString('en-IN')} lakhs<br/>
    • ${profitLossAvg > 0 ? 'Overall positive financial position' : 'Overall negative financial position'} over the 7-year period<br/>
    • Largest profit: ₹${profitLossMax.toLocaleString('en-IN')} lakhs (${years[profitLoss.indexOf(profitLossMax)]})<br/>
    • Largest loss: ₹${Math.abs(profitLossMin).toLocaleString('en-IN')} lakhs (${years[profitLoss.indexOf(profitLossMin)]})
  `;
  document.getElementById('insights-summary-text').innerHTML = insights;
  
  // Initialize Yearly Performance Chart
  const yearlyChart = echarts.init(document.getElementById('yearlyPerformanceChart'));
  const yearlyOption = {
    tooltip: {
      trigger: 'axis',
      formatter: function(params) {
        let result = params[0].name + '<br/>';
        params.forEach(param => {
          if (param.seriesName === 'Net Profit/Loss') {
            const value = param.value;
            const sign = value >= 0 ? '+' : '';
            result += param.marker + param.seriesName + ': ' + sign + '₹' + value.toLocaleString('en-IN') + ' Lakhs<br/>';
          } else {
            result += param.marker + param.seriesName + ': ₹' + param.value.toLocaleString('en-IN') + ' Lakhs<br/>';
          }
        });
        return result;
      }
    },
    legend: {
      data: ['Revenue', 'Expenditure', 'Net Profit/Loss'],
      top: 10
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '3%',
      containLabel: true
    },
    xAxis: {
      type: 'category',
      data: years,
      axisLabel: {
        rotate: 0
      }
    },
    yAxis: [
      {
        type: 'value',
        name: 'Revenue/Expenditure (₹ Lakhs)',
        position: 'left',
        axisLabel: {
          formatter: function(value) {
            return '₹' + (value / 1000).toFixed(0) + 'K';
          }
        }
      },
      {
        type: 'value',
        name: 'Net Profit/Loss (₹ Lakhs)',
        position: 'right',
        axisLabel: {
          formatter: function(value) {
            const sign = value >= 0 ? '+' : '';
            return sign + '₹' + (value / 1000).toFixed(0) + 'K';
          }
        }
      }
    ],
    series: [
      {
        name: 'Revenue',
        type: 'bar',
        data: revenue,
        itemStyle: { color: '#11998e' },
        label: {
          show: true,
          position: 'top',
          formatter: function(params) {
            return '₹' + (params.value / 1000).toFixed(0) + 'K';
          },
          fontSize: 10
        }
      },
      {
        name: 'Expenditure',
        type: 'bar',
        data: expenditure,
        itemStyle: { color: '#ee0979' },
        label: {
          show: true,
          position: 'top',
          formatter: function(params) {
            return '₹' + (params.value / 1000).toFixed(0) + 'K';
          },
          fontSize: 10
        }
      },
      {
        name: 'Net Profit/Loss',
        type: 'line',
        yAxisIndex: 1,
        data: profitLoss,
        itemStyle: {
          color: function(params) {
            return params.value >= 0 ? '#38ef7d' : '#f5576c';
          }
        },
        lineStyle: {
          width: 3
        },
        symbol: 'circle',
        symbolSize: 8,
        label: {
          show: true,
          position: 'top',
          formatter: function(params) {
            const value = params.value;
            const sign = value >= 0 ? '+' : '';
            return sign + '₹' + (value / 1000).toFixed(1) + 'K';
          },
          fontSize: 10
        }
      }
    ]
  };
  yearlyChart.setOption(yearlyOption);
  
  // Handle window resize
  window.addEventListener('resize', function() {
    yearlyChart.resize();
  });
})();
 </script>
</body>
</html>
